document.addEventListener("DOMContentLoaded",function(){askForImage((a)=>loadImage(a,(a)=>letUserDrawAndDownload(a)))});const byId=document.getElementById.bind(document),DEFAULTCOLOR="#2b76ce",DEFAULTSIZE=20;function askForImage(a){function b(d){c.removeEventListener("change",b),a(d.target.files[0])}byId("inputForAFile").style.display="",drawAndDownload.style.display="none";let c=byId("fileinput");c.addEventListener("change",b)}function loadImage(a,b){function c(a){let c=new Image;c.onload=()=>b(c),c.src=a}byId("readme").innerHTML="<h1>Loading ...</h1>";let d=new FileReader;d.onload=()=>c(d.result),d.readAsDataURL(a)}function letUserDrawAndDownload(a){function b(){q=l.getBoundingClientRect(),p=q.width/l.width}function c(a){t.style.background=o.strokeStyle=r.value=a,localStorage.setItem("color",a)}function d(a){t.style.transform="scale("+a/10+")",o.lineWidth=a/p,u.value=a,localStorage.setItem("pensize",a)}function f(a){return{x:(a.clientX-q.left)/p,y:(a.clientY-q.top)/p}}function g(){y||(console.log("startDrawLoop"),y=!0,o.beginPath(),e())}function e(){x=window.requestAnimationFrame(e),h()}function h(){o.moveTo(w.x,w.y),o.lineTo(v.x,v.y),o.stroke(),w=v}function i(a,b){l.addEventListener(a,function(a){a.preventDefault();let{clientX:c,clientY:d}=a.touches[0]||{},e=new MouseEvent(b,{clientX:c,clientY:d});l.dispatchEvent(e)},!1)}function j(){let a=["#FFF","#333"];z.style.backgroundColor=a[A%a.length]}var k=Math.max;const l=byId("drawzone");byId("inputForAFile").style.display="none",byId("drawAndDownload").style.display="";let m=k(window.innerHeight,window.innerWidth),n=k(a.width/m,a.height/m,1);l.width=a.width/n,l.height=a.height/n;let o=l.getContext("2d");o.drawImage(a,0,0,l.width,l.height);let p,q;b(),window.addEventListener("resize",b);const r=byId("colorpicker"),s=byId("pensizePreview"),t=byId("pensizePreviewDot"),u=byId("pensize");c(localStorage.getItem("color")||DEFAULTCOLOR),r.addEventListener("input",(a)=>c(a.target.value)),u.addEventListener("input",(a)=>d(a.target.value)),d(parseInt(localStorage.getItem("pensize"))||DEFAULTSIZE),o.lineCap="round";let v={x:0,y:0},w=v;l.addEventListener("mousedown",function(a){v=w=f(a),g()},!1),document.addEventListener("mouseup",function(){console.log("endDrawLoop"),y=!1,window.cancelAnimationFrame(x),x=null},!1),l.addEventListener("mousemove",function(a){v=f(a)},!1);let x=null,y=!1;i("touchstart","mousedown"),i("touchend","mouseup"),i("touchmove","mousemove"),byId("download").addEventListener("click",function(){let a=(fileinput.value.split("\\").pop().split(".")[0]||"image")+"-edited.png";this.href=l.toDataURL("image/png",0.5),this.download=a},!1);let z=byId("background");z.addEventListener("click",function(){A++,localStorage.setItem("background",A),j()});let A=localStorage.getItem("background")||0;j()}