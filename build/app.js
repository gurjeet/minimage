document.addEventListener('DOMContentLoaded',function(){askForImage()}),window.addEventListener('paste',function(a){handleDataTransferItems(a.clipboardData.items)}),document.body.addEventListener('dragover',function(a){a.preventDefault(),a.stopPropagation()}),document.body.addEventListener('drop',function(a){a.preventDefault(),a.stopPropagation(),handleDataTransferItems(a.dataTransfer.items)});function handleDataTransferItems(a){let b=[].find.call(a,(a)=>'file'==a.kind&&a.type.match('image'));if(originalFileName='pasted-image',b)return console.log('parsing pasted image content'),void loadFile(b.getAsFile());let c=[].find.call(a,(a)=>'string'==a.kind);c&&(console.log('parsing url content'),c.getAsString((a)=>createImageWithFileContent(a)))}const byId=document.getElementById.bind(document),DEFAULTCOLOR='#2b76ce',DEFAULTSIZE=20;var originalFileName='pasted-image';let askingForImage=!0;function askForImage(){function a(c){b.removeEventListener('change',a),originalFileName=b.value.split('\\').pop().split('.')[0]||'image',loadFile(c.target.files[0])}let b=byId('fileinput');b.addEventListener('change',a)}function loadFile(a){byId('readme').innerHTML='<h1>Loading ...</h1>';let b=new FileReader;b.onload=()=>createImageWithFileContent(b.result),b.readAsDataURL(a)}function createImageWithFileContent(a){if(console.log('trying to load file as image'),!askingForImage)return;let b=new Image;b.onload=()=>letUserDrawAndDownload(b),b.src=a}function letUserDrawAndDownload(a){function b(){r=m.getBoundingClientRect(),q=r.width/m.width}function c(a){u.style.background=p.strokeStyle=s.value=a,localStorage.setItem('color',a),d()}function d(){let a=byId('pensizePreviewDot');a.style.border='1px solid '+borderColor(a.style.backgroundColor,byId('background').style.backgroundColor)}function f(a){u.style.transform='scale('+a/10+')',p.lineWidth=a/q,v.value=a,localStorage.setItem('pensize',a)}function g(a){return{x:(a.clientX-r.left)/q,y:(a.clientY-r.top)/q}}function h(){y||(y=!0,p.beginPath(),e())}function e(){y&&(window.requestAnimationFrame(e),i())}function i(){p.moveTo(x.x,x.y),p.lineTo(w.x,w.y),p.stroke(),x=w}function j(a,b){m.addEventListener(a,function(a){a.preventDefault();let{clientX:c,clientY:d}=a.touches[0]||{},e=new MouseEvent(b,{clientX:c,clientY:d});m.dispatchEvent(e)},!1)}function k(){let a=['#FFF','#333'];A.style.backgroundColor=a[B%a.length],d()}var l=Math.max;askingForImage=!1;const m=byId('drawzone');byId('inputForAFile').style.display='none',byId('drawAndDownload').style.display='';let n=l(window.innerHeight,window.innerWidth),o=l(a.width/n,a.height/n,1);m.width=a.width/o,m.height=a.height/o;let p=m.getContext('2d');p.drawImage(a,0,0,m.width,m.height);let q,r;b(),window.addEventListener('resize',b);const s=byId('colorpicker'),t=byId('pensizePreview'),u=byId('pensizePreviewDot'),v=byId('pensize');c(localStorage.getItem('color')||DEFAULTCOLOR),s.addEventListener('input',(a)=>c(a.target.value)),v.addEventListener('input',(a)=>f(a.target.value)),f(parseInt(localStorage.getItem('pensize'))||DEFAULTSIZE),p.lineCap='round';let w={x:0,y:0},x=w;m.addEventListener('mousedown',function(a){w=x=g(a),h()},!1),document.addEventListener('mouseup',function(){y=!1},!1),m.addEventListener('mousemove',function(a){w=g(a)},!1);let y=!1;j('touchstart','mousedown'),j('touchend','mouseup'),j('touchmove','mousemove');var z=0;byId('download').addEventListener('click',function(){let a=originalFileName+'-minimage-'+z+'.png';this.href=m.toDataURL('image/png',0.5),this.download=a,z++},!1);let A=byId('background'),B=localStorage.getItem('background')||0;k(),A.addEventListener('click',function(){B++,localStorage.setItem('background',B),k()})}function colorToRGBA(a){var b=document.createElement('canvas');b.width=b.height=1;var c=b.getContext('2d');return c.clearRect(0,0,1,1),c.fillStyle=a,c.fillRect(0,0,1,1),[...c.getImageData(0,0,1,1).data]}function luminance(a){return colorToRGBA(a).slice(0,3).reduce((c,a)=>c+a,0)/3}function borderColor(a,b){let c=luminance(b),d=luminance(a);return 125<c&&200<d?'black':125>c&&25>d?'white':'transparent'}