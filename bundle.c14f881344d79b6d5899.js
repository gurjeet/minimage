!function(e){function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var t={};n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="/",n(n.s=2)}([function(e,n,t){"use strict";function o(e,n){function t(e){e.preventDefault();var n=(0,d.showDownloadOptions)({}),t=n.failed,c=n.suceeded;r(i,a,o,t,c)}var o=n.OrginalImage,i=n.canvas,a=n.originalFileName;e.addEventListener("click",t)}function i(e){console.log(e)}function r(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i,d=n+"-minimage-"+l+".png";a(e,t,o,r),c(e,d,o,r),l++}function a(e,n,t,o){try{var i=e.getContext("2d"),r=i.globalCompositeOperation;return i.globalCompositeOperation="destination-over",i.drawImage(n,0,0,e.width,e.height),i.globalCompositeOperation=r,o&&setTimeout(o),e}catch(e){t&&t(e)}}function c(e,n,t,o){try{e.toBlob(function(e){try{if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(e,n),o&&setTimeout(o);else{var i=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.setAttribute("href",i),r.setAttribute("download",n),r.click(),o&&setTimeout(o),setTimeout(function(){window.URL.revokeObjectURL(i),document.body.removeChild(r)},3e3)}}catch(e){t&&t(e)}})}catch(e){t&&t(e)}}Object.defineProperty(n,"__esModule",{value:!0}),n.makeDownloadLink=o,n.triggerDownload=r,n.mergeCanvasAndImage=a;var d=t(11),l=0},function(e,n,t){"use strict";function o(e,n){function t(e){27==e.which&&o()}function o(){r.classList.add("closing"),a.classList.add("closing"),setTimeout(function(){document.body.removeChild(r),document.body.removeChild(a)},300),document.removeEventListener("keyup",t)}var r=document.createElement("div");r.classList.add("modal"),r.classList.add(e),document.body.appendChild(r);var a=document.createElement("div");return a.classList.add("modal-backdrop"),document.body.appendChild(a),a.style.zIndex=i,r.style.zIndex=i+1,a.addEventListener("click",o),document.addEventListener("keyup",t),i+=2,n({modal:r,closeModal:o})}Object.defineProperty(n,"__esModule",{value:!0}),n.createModal=o;var i=4},function(e,n,t){e.exports=t(3)},function(e,n,t){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e){function n(e){"eraser"==e?y():w(e)}M=e,O();var t=L("drawzone"),o=L("drawzoneWrapper");L("inputForAFile").style.display="none",L("drawAndDownload").style.display="",console.log(e.width,e.height);var i=2*Math.max(window.innerWidth,window.innerHeight),r=Math.max(e.width/i,e.height/i,1);e.width=t.width=e.width/r,e.height=t.height=e.height/r,o.style.maxWidth=e.width,o.style.maxHeight=e.height,o.appendChild(e);var c=(t.getContext("2d"),!1),d=L("topbar").classList,l=L("background"),u=(0,a.default)(L("pensizePreview"),{canvasForCursor:t,onColorChange:n,elementToContrastWith:l}),p=u.setColorDotSize,m=u.refreshColorPreviewBorder,h=(u.clearColorPicker,(0,f.default)(t,{onMouseDown:function(){t.getClientRects()[0].height+160>window.innerHeight&&d.add("drawInProgress")},onMouseUp:function(){c||(c=!0,download.classList.add("usable")),d.remove("drawInProgress")},OrginalImage:M})),w=h.drawWithColor,y=h.drawWithEraser,C=h.setPencilSize;(0,s.default)(l,{onChange:m}),(0,v.default)(L("pensize"),{onChange:function(e){p(e),C(e)}}),(0,g.makeDownloadLink)(L("download"),{OrginalImage:M,originalFileName:E,canvas:t}),(0,b.detectCtrlS)({canvas:t,OrginalImage:M,originalFileName:E})}t(4);var r=t(5),a=o(r),c=t(8),d=o(c),l=t(9),s=o(l),u=t(10),f=o(u),g=t(0),p=t(12),v=o(p),m=t(13),h=o(m),w=t(14),y=t(15),b=t(16),C=t(17),k=function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n}(C),L=document.getElementById.bind(document);k.install(),(0,w.checkRunWithinWebview)();var E=void 0,M=void 0;(0,d.default)({fileinput:L("fileinput"),onImageCreated:function(e,n){E=n,i(e)},startTask:y.startTask,endTask:y.endTask});var F=(0,h.default)(L("welcome"),{fitWindow:!0}),O=F.stopAnim,x=F.bgColor;L("fileInputWrapper").style.color=x},function(e,n){},function(e,n,t){"use strict";function o(e,n){if("eraser"==e)return"transparent";var t=(0,l.luminance)(n),o=(0,l.luminance)(e);return t>125&&o>200?"black":t<125&&o<25?"white":"transparent"}function i(e){return(0,l.luminance)(e)>127.5?"rgba(0,0,0,0.8)":"rgba(255,255,255,0.8)"}function r(e,n){(0,u.createModal)("color-modal",function(t){function o(e){a(),n(e)}var r=t.modal,a=t.closeModal;s.paletteColors.forEach(function(n){var t=document.createElement("button");t.classList.add("colorbutton"),n===e&&(t.classList.add("active"),t.innerHTML="Selected",t.style.color=i(n)),t.style.backgroundColor=n.toLowerCase(),t.addEventListener("click",function(){return o(n)}),r.appendChild(t)});var c=document.createElement("button");c.classList.add("eraser"),c.addEventListener("click",function(){return o("eraser")}),c.innerHTML='<img src="/images/eraser-color.svg"/><span class="imagelabel">'+("eraser"===e?"Eraser selected":"Eraser")+"</span>",r.appendChild(c)})}function a(e,n,t){var o=n<4?4:n,i=document.createElement("canvas");i.width=i.height=o;var r=i.getContext("2d");"eraser"==t?d(r,o):c(r,o,t);var a=i.toDataURL("image/png");e.style.cursor="url("+a+") "+o/2+" "+o/2+",auto"}function c(e,n,t){e.beginPath(),e.arc(n/2,n/2,n/2,0,2*Math.PI,!1),e.fillStyle=t,e.fill()}function d(e,n){e.fillStyle="#da502d",e.fillRect(0,0,2*n/3,n),e.fillStyle="#6584a5",e.fillRect(2*n/3-1,0,n,n),e.globalCompositeOperation="destination-in",c(e,n,"white")}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,n){function t(){p.style.background=o(v,s.style.backgroundColor)}function i(){r(v,c)}function c(e){console.log("onColorPicked",e),v&&e!==v&&(m=v),localStorage.setItem("previousColor",m),v=e,a(u,h,v),"eraser"==e?(g.style.background="",g.classList.add("eraser")):(g.classList.remove("eraser"),g.style.background=e,t()),localStorage.setItem("color",e),l(e)}function d(e){h=e,a(u,h,v),g.style.transform="scale("+e/w+")",p.style.transform="scale("+(e/w+1/w)+")"}var l=n.onColorChange,s=n.elementToContrastWith,u=n.canvasForCursor,g=e.children[0],p=e.children[1],v=void 0;e.addEventListener("click",i);var m=localStorage.getItem("previousColor")||"eraser",h=void 0,w=g.getBoundingClientRect().width;return window.addEventListener("keydown",function(e){"x"===String.fromCharCode(e.which).toLowerCase()&&(console.log("x switching to "+m),c(m))}),setTimeout(function(){return c(localStorage.getItem("color")||f)}),{clearColorPicker:function(){e.removeEventListener("click",i)},setColorDotSize:d,refreshColorPreviewBorder:t}};var l=t(6),s=t(7),u=t(1),f="#2b76ce"},function(e,n,t){"use strict";function o(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function i(e){var n=document.createElement("canvas");n.width=n.height=1;var t=n.getContext("2d");return t.clearRect(0,0,1,1),t.fillStyle=e,t.fillRect(0,0,1,1),[].concat(o(t.getImageData(0,0,1,1).data)).slice(0,3)}function r(e){return i(e).reduce(function(e,n){return e+n},0)/3}Object.defineProperty(n,"__esModule",{value:!0}),n.colorToRGB=i,n.luminance=r},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.paletteColors="#000000,#FFFFFF,#F44336,#E91E63,#9C27B0,#673AB7,#3F51B5,#2196F3,#03A9F4,#00BCD4,#009688,#4CAF50,#8BC34A,#CDDC39,#FFEB3B,#FFC107,#FF9800,#FF5722,#795548,#9E9E9E,#607D8B".split(",")},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){function n(e){c();var n=new FileReader;n.onload=function(){t(n.result),l()},n.onerror=l,n.readAsDataURL(e)}function t(e){if(c(),u){var n=new Image;n.onload=function(){u=!1,i(n,s),l()},n.onerror=l,n.src=e}}function o(e){var o=Array.prototype.find.call(e,function(e){return"file"==e.kind&&e.type.match("image")});if(s="pasted-image",o)return void n(o.getAsFile());var i=Array.prototype.find.call(e,function(e){return"string"==e.kind});i&&i.getAsString(function(e){return t(e)})}var i=e.onImageCreated,r=e.fileinput,a=e.startTask,c=void 0===a?function(){return null}:a,d=e.endTask,l=void 0===d?function(){return null}:d,s="pasted-image",u=!0;!function(){function e(t){r.removeEventListener("change",e),s=r.value.split("\\").pop().split(".")[0]||"image",n(t.target.files[0])}r&&r.addEventListener("change",e)}(),window.addEventListener("paste",function(e){o(e.clipboardData.items)}),document.body.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()}),document.body.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),o(e.dataTransfer.items)})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,n){function t(){a++,localStorage.setItem("background",a),o()}function o(){var n=["#DDD","#333"],t=a%n.length;e.style.backgroundColor=n[t],i(t);var o=document.body.classList;n.forEach(function(e,n){return o.remove("background_n_"+n)}),o.add("background_n_"+t),r<8?(console.log(0==t?"jour !":"nuit !"),r++):console.log("Monsieur Jacquouille, je vous en prie, à la longue, ça devient casse-pied !")}var i=n.onChange,r=0,a=localStorage.getItem("background")||0;o(),e.addEventListener("click",t)}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,n){function t(){p=e.getBoundingClientRect(),g=p.width/e.width,v&&m&&(m.lineWidth=v/g)}function i(e){return{x:(e.clientX-p.left)/g,y:(e.clientY-p.top)/g}}function r(){y||(y=!0,m.beginPath(),c())}function a(){y&&u(),y=!1}function c(){y&&(window.requestAnimationFrame(c),d())}function d(){m.moveTo(w.x,w.y),m.lineTo(h.x,h.y),m.stroke(),w=h}function l(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;e.addEventListener(n,function(e){e.preventDefault();var n=e.touches[0]||{},i=n.clientX,r=n.clientY,a=new MouseEvent(t,{clientX:i,clientY:r});o.dispatchEvent(a)},!1)}var s=n.onMouseDown,u=n.onMouseUp,f=n.OrginalImage,g=void 0,p=void 0,v=void 0;t(),window.addEventListener("resize",t);var m=e.getContext("2d");m.lineCap="round";var h={x:0,y:0},w=h;e.addEventListener("mousedown",function(n){if(3==n.which)return void(0,o.mergeCanvasAndImage)(e,f);h=w=i(n),r(),s()},!1),document.addEventListener("copy",function(n){n.preventDefault(),(0,o.mergeCanvasAndImage)(e,f),n.clipboardData.setData("text/html",'<img src="'+e.toDataURL()+'"/>')}),document.addEventListener("mouseup",a,!1),e.addEventListener("mousemove",function(e){h=i(e)},!1);var y=!1;return l("touchstart","mousedown"),l("touchend","mouseup",document),l("touchmove","mousemove"),{drawWithEraser:function(){m.globalCompositeOperation="destination-out"},drawWithColor:function(e){m.globalCompositeOperation="source-over",m.strokeStyle=e},setPencilSize:function(e){v=e,m.lineWidth=e/g}}};var o=t(0)},function(e,n,t){"use strict";function o(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function i(e){return o(e),(0,a.createModal)("file-download",function(e){function n(e,n){var t=document.getElementById("downloadIndicator");t.classList.add(e),t.innerHTML=n}var t=e.modal,o=e.closeModal;t.innerHTML='\n        <p id="downloadIndicator">Your download is getting ready</p>\n\n        '+r()+'\n\n          <a class="facebookLink" target="_blank" href="https://www.facebook.com/minimage.tk">\n            Like our facebook page\n          </a>\n\n\n          <a class="githubLink" target="_blank" href="https://github.com/renanlecaro/minimage">\n            This app is open source. See the source code on github.\n          </a>\n\n\n\n\n          <p class="pcHint">Pressing <strong>"X"</strong> will switch between the last 2 used colors.</p>\n          <p class="pcHint">You can edit transparent pngs and keep them transparent</p>\n          <p class="pcHint">Clicking the background around the picture will switch between light and dark background</p>\n\n            <p class="pcHint">You can <strong>paste an image in the page</strong> and it will be loaded</p>\n            <p class="pcHint">You can <strong>drop an image file in the page</strong> and it will be loaded</p>\n            <p class="pcHint">You can right click the canvas and copy its content</p>\n            <p class="pcHint">Pressing <strong>ctrl+s</strong> will trigger the download of the picture</p>\n\n\n\n\n      ',t.addEventListener("click",function(e){var n=e.target.getAttribute("class");return"keepDrawing"==n?o():"newPicture"==n?window.location.reload():console.log("unrecognized click ",e)});var i=!1;return{failed:function(e){i=!0,n("failed","\n          It looks like the download failed, sorry about that.\n          It works best on google chrome.\n          <pre>"+e.stack+"</pre>\n        ")},suceeded:function(){i||n("sucess",'\n        <div>Download started</div>\n        <button class="keepDrawing">Keep drawing on that picture</button>\n        <button class="newPicture">Start with a new picture</button>\n        ')}}})}function r(){return navigator.userAgent.match(/Android/i)?"?fromHomeScreen"===window.location.search?"":"\n    <p>You can add this app to your home screen and it will work\n      offline and in full screen.\n    </p>\n    ":""}Object.defineProperty(n,"__esModule",{value:!0}),n.showDownloadOptions=i;var a=t(1)},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,n){function t(n){e.value=n,localStorage.setItem("pensize",n),i(n)}var i=n.onChange;e.addEventListener("input",function(e){return t(e.target.value)}),t(parseInt(localStorage.getItem("pensize"))||o)};var o=20},function(e,n,t){"use strict";function o(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=e.filter(function(e){return e!=n});return t[Math.floor(Math.random()*t.length)]}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,n){function t(){s&&(e.width=window.innerWidth,e.height=window.innerHeight),f=e.width,g=e.height,u=e.getContext("2d"),u.fillStyle=p,u.fillRect(0,0,f,g),u.lineCap="round",r()}function r(){v={x:f/2,y:g/2},m={x:10*Math.random()-5,y:10*Math.random()-5},h={x:10*Math.random()-5,y:10*Math.random()-5},u.strokeStyle=o(i,p),u.lineWidth=20+40*Math.random(),u.beginPath(),u.moveTo(v.x,v.y)}function a(){h={x:2*Math.random()-1,y:2*Math.random()-1},w=setTimeout(a,100+200*Math.random())}function c(){u.moveTo(v.x,v.y),m.x*=.95,m.y*=.95,m.x+=h.x,m.y+=h.y,v.x+=m.x,v.y+=m.y,u.lineTo(v.x,v.y),u.stroke(),(v.x<-50||v.x>f+50||v.y<-50||v.y>g+50)&&r()}function d(){y&&(window.requestAnimationFrame(d),c())}function l(){y=!1,clearTimeout(w),window.removeEventListener("resize",t)}var s=n.fitWindow,u=void 0,f=void 0,g=void 0,p="#F44336",v=void 0,m=void 0,h=void 0,w=void 0;t(),window.addEventListener("resize",t),a();var y=!0;return d(),{stopAnim:l,bgColor:p}};var i="#F44336,#E91E63,#9C27B0,#673AB7,#3F51B5,#2196F3,#03A9F4,#00BCD4,#009688,#4CAF50,#8BC34A,#CDDC39,#FFEB3B,#FFC107,#FF9800,#FF5722".split(",")},function(e,n,t){"use strict";function o(){if(navigator.userAgent.match(/Android/i)){var e=document.createElement("script");e.src="https://iswebview.herokuapp.com/?callback=JSONPcallback",document.body.appendChild(e)}}Object.defineProperty(n,"__esModule",{value:!0}),n.checkRunWithinWebview=o,window.JSONPcallback=function(e){e.isWebView&&(document.body.classList.add("runningWithinWebview"),document.body.innerHTML='\n      Please open minimage.tk with chrome,\n       it cannot work within another app.\n\n        There may be an option in the menu above the page,\n         something like "Open in Chrome".\n\n         ')}},function(e,n,t){"use strict";function o(){a++,r()}function i(){a--,setTimeout(r)}function r(){spinners.classList[a?"remove":"add"]("hidden")}Object.defineProperty(n,"__esModule",{value:!0}),n.startTask=o,n.endTask=i,n.updateLook=r;var a=0;document.addEventListener("DOMContentLoaded",r)},function(e,n,t){"use strict";function o(e){var n=e.canvas,t=e.OrginalImage,o=e.originalFileName;window.addEventListener("keydown",function(e){(e.ctrlKey||e.metaKey)&&"s"===String.fromCharCode(e.which).toLowerCase()&&(e.preventDefault(),(0,i.triggerDownload)(n,o,t))})}Object.defineProperty(n,"__esModule",{value:!0}),n.detectCtrlS=o;var i=t(0)},function(e,n){function t(){return"serviceWorker"in navigator&&(window.fetch||"imageRendering"in document.documentElement.style)&&("https:"===window.location.protocol||"localhost"===window.location.hostname||0===window.location.hostname.indexOf("127."))}function o(e){if(e||(e={}),t()){navigator.serviceWorker.register("/sw.js")}else if(window.applicationCache){var n=function(){var e=document.createElement("iframe");e.src="/appcache/manifest.html",e.style.display="none",a=e,document.body.appendChild(e)};return void("complete"===document.readyState?setTimeout(n):window.addEventListener("load",n))}}function i(e,n){}function r(){if(t()&&navigator.serviceWorker.getRegistration().then(function(e){if(e)return e.update()}),a)try{a.contentWindow.applicationCache.update()}catch(e){}}var a;n.install=o,n.applyUpdate=i,n.update=r}]);
//# sourceMappingURL=bundle.c14f881344d79b6d5899.js.map